<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Real Temp Mail Inbox</title>
  <style>
    body { font-family: -apple-system, sans-serif; background: #121212; color: #fff; padding: 20px; max-width: 600px; margin: auto; }
    .box { background: #1e1e1e; padding: 20px; border-radius: 10px; text-align: center; }
    input { padding: 10px; width: 70%; text-align: center; font-size: 16px; border-radius: 5px; border: 1px solid #333; background: #2a2a2a; color: #fff; }
    button { padding: 10px 20px; font-size: 16px; cursor: pointer; border-radius: 5px; border: none; background: #007bff; color: white; margin-top: 10px; }
    button:hover { background: #0056b3; }
    #inbox { margin-top: 20px; text-align: left; }
    .email-item { background: #2a2a2a; margin-bottom: 10px; padding: 15px; border-radius: 8px; cursor: pointer; border-left: 4px solid #007bff; }
    .email-item:hover { background: #333; }
    .email-content { background: #fff; color: #000; padding: 15px; border-radius: 8px; margin-top: 20px; display: none; }
  </style>
</head>
<body>

  <div class="box">
    <h2>Your Temp Email</h2>
    <input type="text" id="emailAddress" readonly placeholder="Generating...">
    <br>
    <button onclick="checkInbox()">Check Inbox</button>
  </div>

  <div id="inbox">
    <p style="text-align:center; color:#aaa;">Inbox is empty. Waiting for emails...</p>
  </div>

  <div id="emailView" class="email-content">
    <button onclick="closeEmail()" style="background:#dc3545; float:right; padding:5px 10px;">Close</button>
    <h3 id="eSubject"></h3>
    <p><b>From:</b> <span id="eFrom"></span></p>
    <hr>
    <div id="eBody"></div>
  </div>

  <script>
    let currentLogin = '';
    let currentDomain = '';

    // 1. Generate an email when the page loads
    async function generateEmail() {
      const res = await fetch('https://www.1secmail.com/api/v1/?action=genRandomMailbox&count=1');
      const data = await res.json();
      const email = data[0];
      
      document.getElementById('emailAddress').value = email;
      
      // Split the email into login and domain for the API
      [currentLogin, currentDomain] = email.split('@');
    }

    // 2. Check for new emails
    async function checkInbox() {
      if (!currentLogin) return;
      
      const inboxDiv = document.getElementById('inbox');
      inboxDiv.innerHTML = '<p style="text-align:center; color:#aaa;">Checking...</p>';

      const url = `https://www.1secmail.com/api/v1/?action=getMessages&login=${currentLogin}&domain=${currentDomain}`;
      const res = await fetch(url);
      const emails = await res.json();

      if (emails.length === 0) {
        inboxDiv.innerHTML = '<p style="text-align:center; color:#aaa;">Inbox is empty.</p>';
        return;
      }

      inboxDiv.innerHTML = '<h3>Inbox:</h3>';
      emails.forEach(email => {
        const div = document.createElement('div');
        div.className = 'email-item';
        div.innerHTML = `<strong>${email.subject}</strong><br><small>From: ${email.from}</small>`;
        div.onclick = () => readEmail(email.id);
        inboxDiv.appendChild(div);
      });
    }

    // 3. Read a specific email
    async function readEmail(id) {
      const url = `https://www.1secmail.com/api/v1/?action=readMessage&login=${currentLogin}&domain=${currentDomain}&id=${id}`;
      const res = await fetch(url);
      const emailData = await res.json();

      document.getElementById('eSubject').innerText = emailData.subject;
      document.getElementById('eFrom').innerText = emailData.from;
      // Show HTML body if it exists, otherwise show text body
      document.getElementById('eBody').innerHTML = emailData.htmlBody || emailData.textBody;
      
      document.getElementById('emailView').style.display = 'block';
    }

    function closeEmail() {
      document.getElementById('emailView').style.display = 'none';
    }

    // Start
    generateEmail();
  </script>

</body>
</html>
